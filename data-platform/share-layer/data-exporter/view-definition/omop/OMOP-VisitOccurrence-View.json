{
  "resourceType": "https://sql-on-fhir.org/ig/StructureDefinition/ViewDefinition",
  "url": "https://interop.aphp.fr/ig/fhir/dm/ViewDefinition/OMOP-VisitOccurrence-View",
  "title": "OMOP Visit Occurrence View",
  "description": "ViewDefinition to transform FHIR Encounter resources into OMOP Visit Occurrence table format",
  "name": "OMOP-VisitOccurrence-View",
  "status": "draft",
  "resource": "Encounter",
  "constant": [
    {
      "name": "integerNull",
      "valueInteger": 0
    }
  ],
  "select": [
    {
      "column": [
        {
          "name": "visit_occurrence_id",
          "path": "id",
          "description": "Unique identifier for the visit occurrence",
          "type": "id",
          "tag": [
            {
              "name": "ansi/type",
              "value": "INTEGER"
            }
          ]
        },
        {
          "name": "person_id",
          "path": "subject.getReferenceKey(Patient)",
          "description": "Reference to person from subject",
          "type": "string"
        },
        {
          "name": "visit_concept_id",
          "path": "%integerNull",
          "description": "Visit concept from encounter class",
          "type": "integer"
        },
        {
          "name": "visit_start_datetime",
          "path": "period.start",
          "description": "Visit start datetime from period start",
          "type": "dateTime",
          "tag": [
            {
              "name": "ansi/type",
              "value": "TIMESTAMP"
            }
          ]
        },
        {
          "name": "visit_end_datetime",
          "path": "period.end",
          "description": "Visit end datetime from period end",
          "type": "dateTime",
          "tag": [
            {
              "name": "ansi/type",
              "value": "TIMESTAMP"
            }
          ]
        },
        {
          "name": "visit_source_value",
          "path": "getResourceKey()",
          "description": "Source FHIR Encounter ID for traceability",
          "type": "string",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "visit_source_value_value",
          "path": "identifier.first().value",
          "description": "Source value for visit identification",
          "type": "string",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "visit_source_value_system",
          "path": "identifier.first().system",
          "description": "Source value for visit identification",
          "type": "uri",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "admitted_from_source_value_code",
          "path": "hospitalization.admitSource.coding.first().code",
          "description": "Source value for admission source",
          "type": "code",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "admitted_from_source_value_system",
          "path": "hospitalization.admitSource.coding.first().system",
          "description": "Source value for admission source",
          "type": "uri",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "discharged_to_source_value_code",
          "path": "hospitalization.dischargeDisposition.coding.first().code",
          "description": "Source value for discharge disposition",
          "type": "code",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        },
        {
          "name": "discharged_to_source_value_system",
          "path": "hospitalization.dischargeDisposition.coding.first().system",
          "description": "Source value for discharge disposition",
          "type": "uri",
          "tag": [
            {
              "name": "ansi/type",
              "value": "CHARACTER VARYING"
            }
          ]
        }
      ]
    }
  ]
}
